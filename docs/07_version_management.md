# 版本管理规范

## 文档信息
**文档类型**: 标准规范  
**文档编号**: DOC-STANDARD-002  
**版本**: 1.0.0  
**创建日期**: 2025-05-13  
**最后更新**: 2025-05-13  
**状态**: 已批准  
**负责人**: Frank  
**团队成员**: Frank, 小智  

**相关文档**:
- [文档标准规范](./00_document_standards.md)
- [开发路线图](./04_roadmap.md)
- [配置指南](./06_configuration_guide.md)

## 1. 版本号规范

### 1.1 版本号格式

项目使用语义化版本号 (Semantic Versioning) 格式：

```
v主版本号.次版本号.修订版本号[-预发布标识]
```

- **主版本号**: 当进行不兼容的API更改时递增
- **次版本号**: 当添加向后兼容的功能时递增
- **修订版本号**: 当进行向后兼容的错误修复时递增
- **预发布标识**: 可选，用于标识预发布版本，如 alpha, beta, rc 等

例如：`v2.0.0`, `v2.1.0`, `v2.1.1`, `v2.2.0-beta.1`

### 1.2 版本号递增规则

1. **主版本号 (MAJOR)**:
   - 当进行不兼容的API更改时递增
   - 当系统架构发生重大变更时递增
   - 当数据存储格式发生不兼容变更时递增
   - 主版本号递增时，次版本号和修订版本号重置为0

2. **次版本号 (MINOR)**:
   - 当添加向后兼容的功能时递增
   - 当添加新的配置选项时递增
   - 当进行大量的内部重构但不影响外部接口时递增
   - 次版本号递增时，修订版本号重置为0

3. **修订版本号 (PATCH)**:
   - 当进行向后兼容的错误修复时递增
   - 当进行小规模的性能优化时递增
   - 当更新文档或注释时递增

### 1.3 预发布版本

对于尚未准备好正式发布的版本，可以使用预发布标识：

- **alpha**: 内部测试版本，可能不稳定，功能不完整
- **beta**: 功能完整但可能存在已知问题的测试版本
- **rc** (Release Candidate): 候选发布版本，除非发现严重问题，否则将成为正式版本

例如：`v2.0.0-alpha.1`, `v2.0.0-beta.2`, `v2.0.0-rc.1`

### 1.4 构建元数据

可以在版本号后附加构建元数据，使用加号分隔：

```
v主版本号.次版本号.修订版本号[-预发布标识][+构建元数据]
```

例如：`v2.0.0+20250513`, `v2.0.0-beta.1+exp.sha.5114f85`

## 2. 分支管理策略

### 2.1 主要分支

- **main**: 生产环境稳定版本，始终保持可部署状态
- **refactor**: 用于复杂重构工作，完成后合并回 main 分支
- **feature/xxx**: 用于开发新功能，命名格式: `feature/[功能名称]`
- **bugfix/xxx**: 用于修复 bug，命名格式: `bugfix/[问题简述]`
- **hotfix/xxx**: 用于紧急修复生产环境问题，命名格式: `hotfix/[问题简述]`

### 2.2 分支工作流程

1. **功能开发**:
   - 从 main 分支创建 feature 分支
   - 在 feature 分支上开发功能
   - 完成后通过 Pull Request 合并回 main 分支

2. **Bug 修复**:
   - 从 main 分支创建 bugfix 分支
   - 在 bugfix 分支上修复 bug
   - 完成后通过 Pull Request 合并回 main 分支

3. **紧急修复**:
   - 从生产环境的标签创建 hotfix 分支
   - 在 hotfix 分支上修复问题
   - 完成后合并回 main 分支，并创建新的版本标签

4. **重构工作**:
   - 从 main 分支创建 refactor 分支
   - 在 refactor 分支上进行重构
   - 完成后通过 Pull Request 合并回 main 分支

## 3. 标签管理

### 3.1 版本标签

用于标记重要的发布版本，命名格式: `v[主版本号].[次版本号].[修订版本号]`

例如: `v1.0.0`, `v1.1.0`, `v1.2.3`

### 3.2 稳定版标签

用于标记稳定的生产环境版本，命名格式: `v[版本号]-stable`

例如: `v1.0.0-stable`, `v1.1.0-stable`

### 3.3 里程碑标签

用于标记重要的项目里程碑，命名格式: `milestone-[名称]`

例如: `milestone-phase1-complete`, `milestone-db-migration-complete`

## 4. 版本发布流程

### 4.1 发布准备

1. **代码审查**:
   - 确保所有代码已经过审查
   - 确保所有测试通过
   - 确保文档已更新

2. **版本号更新**:
   - 根据变更内容确定新版本号
   - 更新相关文件中的版本号

3. **更新日志**:
   - 更新 CHANGELOG.md 文件
   - 记录所有重要变更

### 4.2 创建发布

1. **创建版本标签**:
   ```bash
   git tag -a v2.0.0 -m "Release v2.0.0"
   git push origin v2.0.0
   ```

2. **创建稳定版标签** (如适用):
   ```bash
   git tag -a v2.0.0-stable -m "Stable Release v2.0.0"
   git push origin v2.0.0-stable
   ```

3. **创建发布说明**:
   - 在 GitHub/GitLab 上创建发布说明
   - 包含版本亮点、新功能、修复的问题等

### 4.3 部署发布

1. **部署到生产环境**:
   - 按照部署计划部署新版本
   - 监控部署过程

2. **验证部署**:
   - 验证所有功能正常工作
   - 监控系统性能和错误日志

3. **发布通知**:
   - 通知相关团队和用户新版本已发布
   - 提供发布说明和重要变更的摘要

## 5. 当前版本规划

### 5.1 版本历史

| 版本 | 发布日期 | 主要变更 |
|------|----------|----------|
| v1.0.0-stable | 2025-04-15 | 初始稳定版本，支持基本的奖励计算和通知功能 |
| v1.0.1-stable | 2025-04-30 | 修复了奖励翻倍通知功能中的两个BUG |
| milestone-sensitive-information-complete | 2025-05-05 | 完成敏感信息保护项目 |
| milestone-db-equivalence-complete | 2025-05-10 | 完成数据库等价性验证 |

### 5.2 计划版本

| 版本 | 计划发布日期 | 主要变更 |
|------|--------------|----------|
| v2.0.0 | 2025-05-15 | 重构版本，支持数据库存储和文件存储双模式 |
| v2.1.0 | 2025-06-15 | 通知模块重构，支持多种通知渠道 |
| v2.2.0 | 2025-07-15 | 增强报表功能，改进数据可视化 |
| v3.0.0 | 2025-09-15 | 完全迁移到数据库存储，移除文件存储选项 |

## 6. 版本兼容性管理

### 6.1 向后兼容性

- 次版本和修订版本必须保持向后兼容性
- 主版本更新可能包含不兼容的变更，但应提供迁移路径
- 配置文件格式变更应提供兼容层或迁移工具

### 6.2 依赖管理

- 使用 requirements.txt 锁定依赖版本
- 主要依赖更新应在次版本或主版本中进行
- 安全相关的依赖更新可以在修订版本中进行

### 6.3 数据迁移

- 数据格式变更应提供迁移脚本
- 主版本更新可能需要手动数据迁移
- 次版本和修订版本应自动处理数据迁移

## 更新记录

| 版本 | 日期 | 更新者 | 更新内容 |
|------|------|--------|----------|
| 1.0.0 | 2025-05-13 | Frank | 初始版本 |
