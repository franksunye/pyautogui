# 开发路线图

## 已完成项目

### 签约台账数据库化项目
- **设计并创建统一的数据库表结构**
  - 兼容北京和上海的数据格式
  - 支持所有现有功能
- **开发数据处理模块**
  - 实现合同数据处理和保存到数据库的功能
  - 确保与文件存储方式功能完全等价
- **开发数据查询功能**
  - 支持按城市、时间、管家等条件查询数据
  - 优化查询性能
- **全面测试**
  - 确保数据库存储方式与文件存储方式功能完全等价
  - 特别关注奖励计算逻辑和通知逻辑的一致性

## 短期目标 (当前Sprint)

### 奖励系统重构第二阶段
- **实现通用数据处理函数 (process_data_generic)**
  - 支持所有现有功能
  - 处理北京和上海的所有差异
  - 添加详细的文档和注释
- **添加功能标志 (USE_GENERIC_PROCESS_FUNCTION)**
  - 在config.py中添加，默认值设为False
  - 允许在运行时控制是否使用新函数
- **创建包装函数**
  - 实现process_data_apr_beijing_generic
  - 实现process_data_shanghai_apr_generic
  - 确保正确调用process_data_generic
- **添加单元测试**
  - 测试通用数据处理函数
  - 测试包装函数
  - 验证与原始实现的一致性

## 中期目标 (1-3个月)

### 奖励系统重构第三阶段
- **并行运行和验证**
  - 修改现有处理函数，同时运行新旧实现
  - 比较结果，确保功能一致性
  - 记录和分析差异
- **切换到新实现**
  - 将功能标志默认值改为True
  - 监控系统运行，确保稳定
  - 处理发现的问题
- **清理和完成**
  - 移除旧实现代码
  - 更新文档
  - 最终代码审查

### 功能扩展
- **支持更多城市**
  - 添加更多城市的配置
  - 验证通用函数对新城市的支持
- **增强报表功能**
  - 改进数据可视化
  - 添加更多分析指标
- **优化通知系统**
  - 支持更多通知渠道
  - 改进通知内容和格式

## 长期愿景

### 系统架构优化
- **模块化重构**
  - 进一步分离关注点
  - 提高代码复用
- **数据存储完全迁移**
  - 完全迁移到数据库存储，移除文件存储选项
  - 进一步优化数据库结构和查询性能
- **API化**
  - 将核心功能封装为API
  - 支持更灵活的集成方式

### 用户体验提升
- **管理界面优化**
  - 改进Streamlit仪表板
  - 添加更多交互功能
- **自助服务功能**
  - 允许用户自定义报表
  - 提供自助查询接口

## 优先级原则

项目开发优先级按以下原则确定:

1. **稳定性优先**: 确保系统稳定运行是首要任务
2. **重构先于新功能**: 完成重构工作后再添加新功能
3. **测试驱动开发**: 新功能必须有完善的测试
4. **配置驱动设计**: 尽可能通过配置实现新功能，而非修改代码
5. **渐进式改进**: 小步迭代，避免大规模变更

## 当前重点

当前最重要的任务是完成奖励系统重构的第二阶段，实现通用数据处理函数。这将为后续功能扩展和系统优化奠定基础。

签约台账数据库化项目已经成功完成，系统现在支持两种存储方式（文件存储和数据库存储），并且可以通过配置在两种方式之间切换。下一步将是在完成奖励系统重构后，考虑完全迁移到数据库存储，并移除文件存储选项。
