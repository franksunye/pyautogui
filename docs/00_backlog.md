# 项目待办事项

## 待处理用户故事


### 系统测试和优化 (Sprint 4)
**作为** 系统管理员
**我希望** 系统经过充分的手动测试
**以便于** 确保系统稳定可靠

- [ ] **TEST-2**: 通过手工的方式，在本地环境中执行功能测试，仅考虑文件模式和“非通用化数据处理”情况喜喜下的功能 (优先级: 高, 估计: 8小时)

- [ ] **CLEAN-1**: 代码清理 (优先级: 低, 估计: 4小时)
  - 清理测试脚本
  - 移除无用文件
  - 整理项目结构

## v2.0的目标

- 将北京与上海的差异统一化，通用化
  - 测试文件模式功能
  - 测试数据库模式功能
  - 测试通用化数据处理函数


1- 合同与工单的处理，统一逻辑，参数化配置
2- 活动规则的处理，配置化，已经完成，再次审核
3- 通知内容的处理，模板化，已经有处理，再次检查和审核

----- 未来可能要做的事宜 ------

### 通知模块重构 (Sprint 3)
**作为** 系统维护者
**我希望** 通知功能模块化和通用化
**以便于** 更容易维护和扩展通知功能

#### 任务
- [ ] **NOTIF-1**: 实现通知接口和抽象类 (优先级: 高, 估计: 4小时)
  - 创建NotificationChannel和NotificationTemplate接口
  - 实现基础抽象类
  - 编写接口文档

- [ ] **NOTIF-2**: 实现通知渠道类 (优先级: 高, 估计: 6小时)
  - 实现WecomChannel类
  - 实现WechatChannel类
  - 实现WebhookChannel类
  - 确保错误处理和异常恢复

- [ ] **NOTIF-3**: 实现通知模板类 (优先级: 高, 估计: 8小时)
  - 实现ContractNotificationTemplate类
  - 实现AwardNotificationTemplate类
  - 实现TechnicianStatusTemplate类
  - 确保模板的可配置性

- [ ] **NOTIF-4**: 实现通知管理器 (优先级: 高, 估计: 4小时)
  - 实现NotificationManager类
  - 添加渠道和模板注册功能
  - 实现通知发送和状态跟踪

- [ ] **NOTIF-5**: 重构现有通知函数 (优先级: 高, 估计: 8小时)
  - 重构notification_module.py中的函数
  - 重构notification_db_module.py中的函数
  - 确保与现有功能完全兼容

- [ ] **NOTIF-6**: 编写单元测试 (优先级: 高, 估计: 6小时)
  - 为通知接口和类编写测试
  - 为通知渠道编写测试
  - 为通知模板编写测试
  - 为通知管理器编写测试

- [ ] **NOTIF-7**: 更新文档 (优先级: 中, 估计: 4小时)
  - 更新使用说明
  - 更新配置指南
  - 提供示例代码



### 业务规则文档化 (Sprint 3)
**作为** 业务分析师
**我希望** 了解北京和上海数据处理的特殊点和规则差异
**以便于** 更好地理解业务逻辑并进行维护

#### 任务
- [x] **DOC-1**: 分析北京和上海数据处理差异 (优先级: 中, 估计: 6小时, 完成: 2025-05-13)
  - 分析合同金额最大上限规则
  - 分析奖励计算规则差异
  - 分析通知内容差异

- [x] **DOC-2**: 更新当前已有的业务规则文档 docs 目录下核心文档内容 (优先级: 中, 估计: 8小时, 完成: 2025-05-13)
  - 记录所有业务规则
  - 提供规则示例
  - 解释规则背后的业务逻辑

------ 已经完成的里程碑的记录 ------

## 里程碑

### 里程碑 1: 数据处理模块重构 (已完成: 2025-05-15)
- ✓ 在开发环境，实测5月北京，验证原方式与新方式功能完全等价（完成：2025-05-12）
- ✓ 在开发环境，实测5月上海，验证原方式与新方式功能完全等价（完成：2025-05-14）
- ✓ 修复奖励翻倍通知功能中的两个BUG（完成：2025-05-15）
  - 上海技术工程师不再显示徽章和参与奖励翻倍
  - 北京只有节节高奖励才会翻倍，幸运数字奖励不再翻倍

### 里程碑 2: 数据库模式优化 (已完成: 2025-05-13)
- ✓ 数据库模式中，针对已有的合同的处理逻辑，已经确认，主体逻辑一致（完成：2025-05-13）
- ✓ 修复数据库模式下合同计数的不一致问题（完成：2025-05-13）
- ✓ 确保重构版本包含所有生产环境的修复（完成：2025-05-13）
- ✓ 清理所有delay_seconds相关代码和配置（完成：2025-05-13）

### 里程碑 3: 通知模块基础重构 (已完成: 2025-05-16)
- ✓ 创建通知模块重构计划（完成：2025-05-15）
- ✓ 创建通知模块重构任务列表（完成：2025-05-15）
- ✓ 完成通知模块设计文档（完成：2025-05-16）
- ✓ 实现通知工具函数模块（完成：2025-05-16）
- ✓ 实现通知模板函数模块（完成：2025-05-16）
- ✓ 实现统一的活动配置结构（完成：2025-05-16）
